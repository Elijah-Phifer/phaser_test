<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Phaser 3 — Grid + On‑Screen Buttons (Minimal)</title>
    <style>
      html, body { height: 100%; margin: 0; background:#0f1220; }
      #game { width: 100%; height: calc(100% - 140px); }
      .pad { position: fixed; left: 50%; bottom: 12px; transform: translateX(-50%);
             display: grid; grid-template-columns: 64px 64px 64px; grid-template-rows: 64px 64px 64px; gap: 8px; }
      .pad button { background:#1f2540; color:#e2e8f0; border:1px solid #394264; border-radius:12px; font-size:18px; cursor:pointer; }
      .pad button:active { transform: translateY(1px); }
      .hud { position: fixed; left: 12px; top: 12px; color: #cbd5e1; font-family: system-ui, sans-serif; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.0/dist/phaser.min.js"></script>
  </head>
  <body>
    <div id="game"></div>

    <div class="hud">Use the on‑screen D‑pad or arrow keys to move one tile.</div>

    <!-- Simple D‑pad -->
    <div class="pad">
      <div></div>
      <button id="btnUp">▲</button>
      <div></div>
      <button id="btnLeft">◀</button>
      <div></div>
      <button id="btnRight">▶</button>
      <div></div>
      <button id="btnDown">▼</button>
      <div></div>
    </div>

    <script>
    // ==== Basics ====
    const TILE = 64;          // tile size in pixels
    const GRID_W = 8;         // columns
    const GRID_H = 8;         // rows
    const PADDING = 24;       // board margin
    const BOARD_W = GRID_W * TILE;
    const BOARD_H = GRID_H * TILE;

    const config = {
      type: Phaser.AUTO,
      parent: 'game',
      width: BOARD_W + PADDING*2,
      height: BOARD_H + PADDING*2,
      backgroundColor: '#0f1220',
      scene: { preload, create }
    };

    const game = new Phaser.Game(config);

    // globals inside this script
    let hero, gridGfx;

    function preload() {
      // generate a simple square as our "sprite"
      const g = this.add.graphics();
      g.fillStyle(0x4cc9f0, 1); g.fillRoundedRect(0, 0, 52, 52, 10);
      g.generateTexture('hero', 52, 52); g.destroy();
    }

    function create() {
      // draw grid
      gridGfx = this.add.graphics();
      gridGfx.lineStyle(2, 0x2a2f45, 1);
      gridGfx.strokeRect(PADDING, PADDING, BOARD_W, BOARD_H);
      for (let x = 1; x < GRID_W; x++) {
        const px = PADDING + x * TILE; gridGfx.lineBetween(px, PADDING, px, PADDING + BOARD_H);
      }
      for (let y = 1; y < GRID_H; y++) {
        const py = PADDING + y * TILE; gridGfx.lineBetween(PADDING, py, PADDING + BOARD_W, py);
      }

      // add hero at grid (3,3)
      const start = { gx: 3, gy: 3 };
      const { wx, wy } = tileToWorld(start.gx, start.gy);
      hero = this.add.sprite(wx, wy, 'hero').setOrigin(0.5);
      hero.setData({ gx: start.gx, gy: start.gy });

      // keyboard arrows
      this.input.keyboard.on('keydown-UP', () => moveBy(0,-1, this));
      this.input.keyboard.on('keydown-DOWN', () => moveBy(0, 1, this));
      this.input.keyboard.on('keydown-LEFT', () => moveBy(-1,0, this));
      this.input.keyboard.on('keydown-RIGHT', () => moveBy(1,0, this));

      // hook up on‑screen buttons
      document.getElementById('btnUp').onclick = () => moveBy(0,-1, this);
      document.getElementById('btnDown').onclick = () => moveBy(0, 1, this);
      document.getElementById('btnLeft').onclick = () => moveBy(-1,0, this);
      document.getElementById('btnRight').onclick = () => moveBy(1,0, this);
    }

    // ==== helpers ====
    function tileToWorld(gx, gy) {
      const wx = PADDING + gx * TILE + TILE/2;
      const wy = PADDING + gy * TILE + TILE/2;
      return { wx, wy };
    }

    function clamp(v, lo, hi){ return Math.max(lo, Math.min(hi, v)); }

    function moveBy(dx, dy, scene) {
      let gx = hero.getData('gx');
      let gy = hero.getData('gy');
      gx = clamp(gx + dx, 0, GRID_W-1);
      gy = clamp(gy + dy, 0, GRID_H-1);
      hero.setData('gx', gx); hero.setData('gy', gy);
      const { wx, wy } = tileToWorld(gx, gy);
      scene.tweens.add({ targets: hero, x: wx, y: wy, duration: 100 });
    }
    </script>
  </body>
</html>